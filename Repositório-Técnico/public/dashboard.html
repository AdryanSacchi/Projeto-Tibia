<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/dashboard.css">
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="dash">
        <div class="header">
            <div class="icones-header">
                <img onclick="mage()" src="assets/icon/mage-dash.png" alt="Icone Mage" class="header-personagem">
                <img onclick="archer()" src="assets/icon/archer-dash.png" alt="Icone Archer" class="header-personagem">
                <img onclick="druid()" src="assets/icon/druid-dash.png" alt="Icone Druid" class="header-personagem">
                <img onclick="knight()" src="assets/icon/knight-dash.png" alt="Icone Knight" class="header-personagem">
                <img onclick="monk()" src="assets/icon/monk2-dash.png" alt="Icone Monk" class="header-personagem">
            </div>
        </div>
        <div class="player-info">
            <img style="background-color: rgb(64, 88, 87);" src="assets/icon/image.png" alt="Icone Player"
                class="header-playerinfo">
            <p style="margin-right: 30%; display:flex; justify-content: center; font-size: 50px;">PLAYER NAME</p>
            <div class="botoesPlayer">
                <a id="botaoVoltar" href="quizz.html">Voltar</a><br>
                <a id="botaoSair" href="index.html">Sair</a><br>
            </div>

        </div>

        <div class="dashboard">
            <div class="card-kpi">PISO MÁXIMO: <span id="spanPisoMaximo">--</span></div>
            <div class=" card-kpi">VIDA FINAL: <span id="spanVidaFinal">--</span></div>
            <div class="card-kpi" id="descricaoClasse">Selecione uma classe</div>
            <div class="selecao-personagem">
                <img src="assets/icon/mage-dash.png" alt="Imagem do PERSONAGEM" id="personagem">

                <canvas id="meuGraficoRadar"></canvas>

                <div class="painel-lateral">
                    <h3 class="titulo-habilidades">Habilidades</h3>
                    <div class="habilidades">
                        <img id="hab1" src="assets/icon/Spell-Kina1.gif" alt="Habilidade 1">
                        <img id="hab2" src="assets/icon/Spell-Kina2.gif" alt="Habilidade 2">
                        <img id="hab3" src="assets/icon/Spell-Kina3.gif" alt="Habilidade 3">
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<script>


    function carregarDadosDashboard() {
        const idUsuario = sessionStorage.ID_USUARIO;

        if (!idUsuario) {
            alert("Usuário não logado!");
            return;
        }

        fetch(`/usuarios/dados/${idUsuario}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (response) {
            if (response.ok) {
                response.json().then(dados => {
                    console.log("Dados recebidos:", dados);
                    document.getElementById('spanPisoMaximo').innerText = dados.piso_final || 0;
                    document.getElementById('spanVidaFinal').innerText = dados.vida_final || 0;
                    document.querySelector('.player-info p').innerText = dados.nick_name || "HERÓI";
                    atualizarGraficoRadar(dados);
                    montarRadar(dados)
                });
            } else {
                console.error("Erro ao buscar dados do dashboard: " + response.status);
            }
        }).catch(function (erro) {
            console.error("Erro de rede:", erro);
        });
    }


    function atualizarDescricaoClasse(texto) {
        document.getElementById("descricaoClasse").innerText = texto;
    }

    function atualizarGraficoRadar(dados) {
        const novosDados = [
            dados.forca || 0,
            dados.agilidade || 0,
            dados.inteligencia || 0,
            dados.sorte || 0,
            dados.resistencia || 0
        ];

        const habilidade1 = document.getElementById("hab1");
        const habilidade2 = document.getElementById("hab2");
        const habilidade3 = document.getElementById("hab3");

        meuGrafico.data.datasets[0].data = novosDados;
        meuGrafico.update();

        if (dados.forca >= 7 || dados.resistencia >= 6) {
            personagem.src = "assets/icon/knight-dash.png";
            habilidade1.src = "assets/icon/Spell-Kina1.gif";
            habilidade2.src = "assets/icon/Spell-Kina2.gif";
            habilidade3.src = "assets/icon/Spell-Kina3.gif";

            atualizarDescricaoClasse("Como sua FORÇA ou sua RESISTENCIA é maior que seus outros atributos, seria uma boa ideia ir pelo caminho do Guerreiro!")
        } else if (dados.inteligencia >= 6 && dados.resistencia >= 5) {
            personagem.src = "assets/icon/monk2-dash.png";
            habilidade1.src = "assets/icon/Spell-Monk1.gif";
            habilidade2.src = "assets/icon/Spell-Monk2.gif";
            habilidade3.src = "assets/icon/Spell-Monk3.gif";
            atualizarDescricaoClasse("Como seus atributos estão distribuidos e sua AGILIDADE não é tao boa, seria uma boa ideia ir pelo caminho do Monge!")
        } else if (dados.agilidade >= 6 || dados.sorte >= 6) {
            personagem.src = "assets/icon/archer-dash.png";
            habilidade1.src = "assets/icon/Spell-Pala1.gif";
            habilidade2.src = "assets/icon/Spell-Pala2.gif";
            habilidade3.src = "assets/icon/Spell-Pala3.gif";
            atualizarDescricaoClasse("Como sua AGILIDADE ou sua SORTE se destacam, seria uma boa escolha ir pelo caminho do Paladino!")
        } else if (dados.inteligencia > dados.forca && dados.inteligencia > dados.agilidade) {
            personagem.src = "assets/icon/druid-dash.png";
            habilidade1.src = "assets/icon/Spell-Druid1.gif";
            habilidade2.src = "assets/icon/Spell-Druid2.gif";
            habilidade3.src = "assets/icon/Spell-Druid3.gif";
            atualizarDescricaoClasse("Como seus atributos em destaque não são nem FORÇA e nem AGILIDADEE, é uma opção seguir o caminho do Druida!")
        } else {

        }
    }




    window.onload = function () {
        carregarDadosDashboard();
    };

    function archer() {
        personagem.src = "assets/icon/archer-dash.png";
    }

    function mage() {
        personagem.src = "assets/icon/mage-dash.png";
    }

    function monk() {
        personagem.src = "assets/icon/monk2-dash.png";
    }

    function druid() {
        personagem.src = "assets/icon/druid-dash.png";
    }

    function knight() {
        personagem.src = "assets/icon/knight-dash.png";
    }

    const ctx = document.getElementById('meuGraficoRadar').getContext('2d');

    const meuGrafico = new Chart(ctx, {
        type: 'radar', //
        data: {
            labels: [
                'Força',
                'Agilidade',
                'Inteligência',
                'Sorte',
                'Resistência'
            ],
            datasets: [{
                label: 'Status do Personagem',
                data: [1, 45, 100, 45, 20],
                fill: true,
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                borderColor: 'rgb(54, 162, 235)',
                pointBackgroundColor: 'rgb(54, 162, 235)',
                pointBorderColor: '#fff',
                pointHoverBackgroundColor: '#fff',
                pointHoverBorderColor: 'rgb(54, 162, 235)'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            elements: {
                line: {
                    borderWidth: 1
                }
            },
            scales: {
                r: {
                    angleLines: {
                        display: false
                    },
                    ticks: {
                        display: false
                    }
                }
            }
        }
    });

</script>